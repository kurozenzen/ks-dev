import{s as V,f as S,l as U,a as B,g as E,h as P,m as F,d as h,c as j,j as c,i as I,u as M,n as O,v as k,e as J,y as Ze,I as Te,D as Ye,z,H as D,T as Ne,J as ce,r as ue,U as te,V as se,O as De,K as Q,k as oe,o as xe,M as $e,W as et,G as fe,L as tt,S as st,p as X,Q as nt,E as he}from"./scheduler.2e119837.js";import{h as _e,u as lt}from"./await_block.f7fb3241.js";import{e as ne}from"./each.e59479a4.js";import{S as G,i as R,a as C,t as L,g as re,c as ae,b as Z,d as Y,m as x,e as $,r as rt,f as de}from"./index.564f3e18.js";import{L as at}from"./LoadingAnimation.392b4d60.js";import{f as me}from"./format-tag.7e313273.js";import{i as it}from"./tags.49324235.js";import{a as ie}from"./active-tags-store.80efbdb8.js";import{S as ot}from"./SimpleTag.e611ea2f.js";import{b as ee}from"./paths.1bcf40a5.js";import{h as ct}from"./always-loop-store.ba41ce48.js";const ut="https://api.rule34.xxx/index.php?page=dapi&s=comment&q=index&json=1",ge=async(s=void 0)=>{if(typeof s!="number"&&s!==void 0)throw new TypeError("Invalid postId");const e=new URL(ut);s!==void 0&&e.searchParams.append("post_id",String(s));const t=await fetch(e);if(!t.ok)throw new Error("Failed to get tag suggestions");const l=await t.text(),o=new DOMParser().parseFromString(l,"text/xml"),r=[];for(const i of o.getElementsByTagName("comment"))r.push(ft(i.attributes));return r},ft=s=>{const e=s.getNamedItem("creator"),t=s.getNamedItem("created_at"),l=s.getNamedItem("body");if(e==null||t==null||l==null)throw new Error(`Failed to parse comment, attribute was null. ${e}, ${t}, ${l}`);return{author:e.value,createdAt:t.value,content:l.value}},pe=6e4,le=s=>{if(!ht(s))throw new TypeError("Invalid createdAt passed to formatCreatedAt");const e=new Date(s).getTime()/pe,l=new Date().getTime()/pe-e;if(l<1)return"just now";if(l<60)return W(l,"minute");const n=l/60;if(n<24)return W(n,"hour");const o=n/24;if(o<7)return W(o,"day");if(o<30.5)return W(o/7,"week");if(o<365.25)return W(o/30.5,"month");const r=o/365.25;return W(r,"year")},ht=s=>(typeof s=="number"||typeof s=="string")&&new Date(s).toString()!=="Invalid Date",W=(s,e)=>{const t=s.toFixed();return`${t} ${e}${t==="1"?"":"s"} ago`};function _t(s){let e,t,l=s[0].author+"",n,o,r,i=le(s[0].createdAt)+"",a,u,f,A=s[0].content+"",m;return{c(){e=S("div"),t=S("span"),n=U(l),o=B(),r=S("span"),a=U(i),u=B(),f=S("span"),m=U(A),this.h()},l(w){e=E(w,"DIV",{class:!0});var g=P(e);t=E(g,"SPAN",{class:!0});var T=P(t);n=F(T,l),T.forEach(h),o=j(g),r=E(g,"SPAN",{class:!0});var p=P(r);a=F(p,i),p.forEach(h),u=j(g),f=E(g,"SPAN",{class:!0});var d=P(f);m=F(d,A),d.forEach(h),g.forEach(h),this.h()},h(){c(t,"class","author svelte-bys59y"),c(r,"class","created-at svelte-bys59y"),c(f,"class","content svelte-bys59y"),c(e,"class","svelte-bys59y")},m(w,g){I(w,e,g),M(e,t),M(t,n),M(e,o),M(e,r),M(r,a),M(e,u),M(e,f),M(f,m)},p(w,[g]){g&1&&l!==(l=w[0].author+"")&&O(n,l),g&1&&i!==(i=le(w[0].createdAt)+"")&&O(a,i),g&1&&A!==(A=w[0].content+"")&&O(m,A)},i:k,o:k,d(w){w&&h(e)}}}function dt(s,e,t){let{comment:l}=e;return s.$$set=n=>{"comment"in n&&t(0,l=n.comment)},[l]}class mt extends G{constructor(e){super(),R(this,e,dt,_t,V,{comment:0})}}function ye(s,e,t){const l=s.slice();return l[2]=e[t],l}function gt(s){return{c:k,l:k,m:k,p:k,i:k,o:k,d:k}}function pt(s){let e,t,l,n;const o=[bt,yt],r=[];function i(a,u){return a[1].length>0?0:1}return e=i(s),t=r[e]=o[e](s),{c(){t.c(),l=J()},l(a){t.l(a),l=J()},m(a,u){r[e].m(a,u),I(a,l,u),n=!0},p(a,u){let f=e;e=i(a),e===f?r[e].p(a,u):(re(),L(r[f],1,1,()=>{r[f]=null}),ae(),t=r[e],t?t.p(a,u):(t=r[e]=o[e](a),t.c()),C(t,1),t.m(l.parentNode,l))},i(a){n||(C(t),n=!0)},o(a){L(t),n=!1},d(a){a&&h(l),r[e].d(a)}}}function yt(s){let e,t="Comments for this post are not available. <br/>This can happen if comments have been deleted.";return{c(){e=S("p"),e.innerHTML=t,this.h()},l(l){e=E(l,"P",{class:!0,"data-svelte-h":!0}),Ze(e)!=="svelte-1f9q9vq"&&(e.innerHTML=t),this.h()},h(){c(e,"class","no-comments svelte-x6zn2h")},m(l,n){I(l,e,n)},p:k,i:k,o:k,d(l){l&&h(e)}}}function bt(s){let e,t,l=ne(s[1]),n=[];for(let r=0;r<l.length;r+=1)n[r]=be(ye(s,l,r));const o=r=>L(n[r],1,1,()=>{n[r]=null});return{c(){e=S("ul");for(let r=0;r<n.length;r+=1)n[r].c();this.h()},l(r){e=E(r,"UL",{class:!0});var i=P(e);for(let a=0;a<n.length;a+=1)n[a].l(i);i.forEach(h),this.h()},h(){c(e,"class","comments svelte-x6zn2h")},m(r,i){I(r,e,i);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null);t=!0},p(r,i){if(i&1){l=ne(r[1]);let a;for(a=0;a<l.length;a+=1){const u=ye(r,l,a);n[a]?(n[a].p(u,i),C(n[a],1)):(n[a]=be(u),n[a].c(),C(n[a],1),n[a].m(e,null))}for(re(),a=l.length;a<n.length;a+=1)o(a);ae()}},i(r){if(!t){for(let i=0;i<l.length;i+=1)C(n[i]);t=!0}},o(r){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)L(n[i]);t=!1},d(r){r&&h(e),Te(n,r)}}}function be(s){let e,t;return e=new mt({props:{comment:s[2]}}),{c(){Z(e.$$.fragment)},l(l){Y(e.$$.fragment,l)},m(l,n){x(e,l,n),t=!0},p(l,n){const o={};n&1&&(o.comment=l[2]),e.$set(o)},i(l){t||(C(e.$$.fragment,l),t=!0)},o(l){L(e.$$.fragment,l),t=!1},d(l){$(e,l)}}}function vt(s){let e,t;return e=new at({}),{c(){Z(e.$$.fragment)},l(l){Y(e.$$.fragment,l)},m(l,n){x(e,l,n),t=!0},p:k,i(l){t||(C(e.$$.fragment,l),t=!0)},o(l){L(e.$$.fragment,l),t=!1},d(l){$(e,l)}}}function kt(s){let e,t,l,n={ctx:s,current:null,token:null,hasCatch:!1,pending:vt,then:pt,catch:gt,value:1,blocks:[,,,]};return _e(t=ge(s[0].id),n),{c(){e=J(),n.block.c()},l(o){e=J(),n.block.l(o)},m(o,r){I(o,e,r),n.block.m(o,n.anchor=r),n.mount=()=>e.parentNode,n.anchor=e,l=!0},p(o,[r]){s=o,n.ctx=s,r&1&&t!==(t=ge(s[0].id))&&_e(t,n)||lt(n,s,r)},i(o){l||(C(n.block),l=!0)},o(o){for(let r=0;r<3;r+=1){const i=n.blocks[r];L(i)}l=!1},d(o){o&&h(e),n.block.d(o),n.token=null,n=null}}}function wt(s,e,t){let{post:l}=e;return s.$$set=n=>{"post"in n&&t(0,l=n.post)},[l]}class os extends G{constructor(e){super(),R(this,e,wt,kt,V,{post:0})}}function St(s){let e,t=s[0].charAt(0).toUpperCase()+"",l,n;return{c(){e=S("span"),l=U(t),this.h()},l(o){e=E(o,"SPAN",{title:!0,class:!0});var r=P(e);l=F(r,t),r.forEach(h),this.h()},h(){c(e,"title",n="Rated "+s[0]+"."),c(e,"class","svelte-1nbj6kf")},m(o,r){I(o,e,r),M(e,l)},p(o,[r]){r&1&&t!==(t=o[0].charAt(0).toUpperCase()+"")&&O(l,t),r&1&&n!==(n="Rated "+o[0]+".")&&c(e,"title",n)},i:k,o:k,d(o){o&&h(e)}}}function Et(s,e,t){let{value:l}=e;return s.$$set=n=>{"value"in n&&t(0,l=n.value)},[l]}class cs extends G{constructor(e){super(),R(this,e,Et,St,V,{value:0})}}function At(s){let e,t=le(s[0])+"",l;return{c(){e=S("span"),l=U(t),this.h()},l(n){e=E(n,"SPAN",{class:!0});var o=P(e);l=F(o,t),o.forEach(h),this.h()},h(){c(e,"class","svelte-1vqihm9")},m(n,o){I(n,e,o),M(e,l)},p(n,[o]){o&1&&t!==(t=le(n[0])+"")&&O(l,t)},i:k,o:k,d(n){n&&h(e)}}}function It(s,e,t){let{value:l}=e;return s.$$set=n=>{"value"in n&&t(0,l=n.value)},[l]}class us extends G{constructor(e){super(),R(this,e,It,At,V,{value:0})}}function Tt(s){let e,t=me(s[0])+"",l;return{c(){e=S("span"),l=U(t),this.h()},l(n){e=E(n,"SPAN",{"data-testid":!0,class:!0});var o=P(e);l=F(o,t),o.forEach(h),this.h()},h(){c(e,"data-testid","score"),c(e,"class","codicon codicon-heart svelte-te86f3")},m(n,o){I(n,e,o),M(e,l)},p(n,[o]){o&1&&t!==(t=me(n[0])+"")&&O(l,t)},i:k,o:k,d(n){n&&h(e)}}}function Nt(s,e,t){let{value:l}=e;return s.$$set=n=>{"value"in n&&t(0,l=n.value)},[l]}class fs extends G{constructor(e){super(),R(this,e,Nt,Tt,V,{value:0})}}function ve(s){let e,t,l,n,o;return{c(){e=S("a"),t=S("i"),l=B(),n=U(s[1]),this.h()},l(r){e=E(r,"A",{href:!0,target:!0,class:!0});var i=P(e);t=E(i,"I",{class:!0}),P(t).forEach(h),l=j(i),n=F(i,s[1]),i.forEach(h),this.h()},h(){c(t,"class","codicon codicon-link"),c(e,"href",o=s[0].toString()),c(e,"target","_newtab"),c(e,"class","svelte-1orztco")},m(r,i){I(r,e,i),M(e,t),M(e,l),M(e,n)},p(r,i){i&2&&O(n,r[1]),i&1&&o!==(o=r[0].toString())&&c(e,"href",o)},d(r){r&&h(e)}}}function Dt(s){let e,t=s[0]&&ve(s);return{c(){t&&t.c(),e=J()},l(l){t&&t.l(l),e=J()},m(l,n){t&&t.m(l,n),I(l,e,n)},p(l,[n]){l[0]?t?t.p(l,n):(t=ve(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:k,o:k,d(l){l&&h(e),t&&t.d(l)}}}function Mt(s,e,t){let l,n,{source:o}=e;return s.$$set=r=>{"source"in r&&t(2,o=r.source)},s.$$.update=()=>{var r;s.$$.dirty&4&&t(0,l=it(o)?new URL(o):null),s.$$.dirty&1&&t(1,n=(r=l==null?void 0:l.hostname)==null?void 0:r.replace(/^www./,""))},[l,n,o]}class hs extends G{constructor(e){super(),R(this,e,Mt,Dt,V,{source:2})}}function Pt(s){let e,t;return{c(){e=S("a"),t=U("Open"),this.h()},l(l){e=E(l,"A",{href:!0,target:!0,class:!0});var n=P(e);t=F(n,"Open"),n.forEach(h),this.h()},h(){c(e,"href",s[0]),c(e,"target","_newtab"),c(e,"class","codicon codicon-link-external svelte-10flxu9")},m(l,n){I(l,e,n),M(e,t)},p(l,[n]){n&1&&c(e,"href",l[0])},i:k,o:k,d(l){l&&h(e)}}}function Ct(s,e,t){let{url:l}=e;return s.$$set=n=>{"url"in n&&t(0,l=n.url)},[l]}class _s extends G{constructor(e){super(),R(this,e,Ct,Pt,V,{url:0})}}function Lt(s){let e,t,l;return{c(){e=S("a"),t=S("i"),l=U(" File"),this.h()},l(n){e=E(n,"A",{href:!0,target:!0,class:!0});var o=P(e);t=E(o,"I",{class:!0}),P(t).forEach(h),l=F(o," File"),o.forEach(h),this.h()},h(){c(t,"class","codicon codicon-file"),c(e,"href",s[0]),c(e,"target","_newtab"),c(e,"class","svelte-1orztco")},m(n,o){I(n,e,o),M(e,t),M(e,l)},p(n,[o]){o&1&&c(e,"href",n[0])},i:k,o:k,d(n){n&&h(e)}}}function Vt(s,e,t){let{url:l}=e;return s.$$set=n=>{"url"in n&&t(0,l=n.url)},[l]}class ds extends G{constructor(e){super(),R(this,e,Vt,Lt,V,{url:0})}}function ke(s,e,t){const l=s.slice();l[4]=e[t];const n=l[1].find(function(...r){return s[3](l[4],...r)})!==void 0;return l[5]=n,l}function we(s){let e,t;function l(){return s[2](s[5],s[4])}return e=new ot({props:{tag:s[4],active:s[5]}}),e.$on("click",l),{c(){Z(e.$$.fragment)},l(n){Y(e.$$.fragment,n)},m(n,o){x(e,n,o),t=!0},p(n,o){s=n;const r={};o&1&&(r.tag=s[4]),o&3&&(r.active=s[5]),e.$set(r)},i(n){t||(C(e.$$.fragment,n),t=!0)},o(n){L(e.$$.fragment,n),t=!1},d(n){$(e,n)}}}function Gt(s){let e,t,l=ne(s[0]),n=[];for(let r=0;r<l.length;r+=1)n[r]=we(ke(s,l,r));const o=r=>L(n[r],1,1,()=>{n[r]=null});return{c(){e=S("ul");for(let r=0;r<n.length;r+=1)n[r].c();this.h()},l(r){e=E(r,"UL",{class:!0});var i=P(e);for(let a=0;a<n.length;a+=1)n[a].l(i);i.forEach(h),this.h()},h(){c(e,"class","tags svelte-b5q4us")},m(r,i){I(r,e,i);for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(e,null);t=!0},p(r,[i]){if(i&3){l=ne(r[0]);let a;for(a=0;a<l.length;a+=1){const u=ke(r,l,a);n[a]?(n[a].p(u,i),C(n[a],1)):(n[a]=we(u),n[a].c(),C(n[a],1),n[a].m(e,null))}for(re(),a=l.length;a<n.length;a+=1)o(a);ae()}},i(r){if(!t){for(let i=0;i<l.length;i+=1)C(n[i]);t=!0}},o(r){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)L(n[i]);t=!1},d(r){r&&h(e),Te(n,r)}}}function Rt(s,e,t){let l;Ye(s,ie,i=>t(1,l=i));let{tags:n}=e;const o=(i,a)=>i?ie.removeByName(a.name):ie.addOrReplace({...a,modifier:"+"}),r=(i,a)=>a.name===i.name;return s.$$set=i=>{"tags"in i&&t(0,n=i.tags)},[n,l,o,r]}class ms extends G{constructor(e){super(),R(this,e,Rt,Gt,V,{tags:0})}}const Me=s=>s.endsWith(".gif"),Ut=(s,e,t)=>Me(e)?{static:t,animated:e}:{static:e,animated:s},Pe=s=>s.endsWith(".mp4")||s.endsWith(".webm"),gs=(s,e,t)=>Pe(e)?{static:t,animated:e}:{static:e,animated:s},ps=s=>s.some(e=>e.name==="loop"),ys=s=>Me(s)||Pe(s),Ce=s=>(s==null?void 0:s.key)===" ",Ft=s=>(s==null?void 0:s.key)==="Enter",Le=s=>{var e,t;Ft(s)&&((t=(e=s.target)==null?void 0:e.click)==null||t.call(e))},Ot="1250px",H=new IntersectionObserver(s=>{var e;for(const t of s){const l=t.isIntersecting?t.target.getAttribute("data-src")??"":"";(e=t==null?void 0:t.target)==null||e.setAttribute("src",l)}},{rootMargin:Ot}),Ve=s=>(H==null||H.observe(s),{destroy(){H==null||H.unobserve(s)}});function zt(s){let e,t,l,n,o,r,i,a;return{c(){e=S("div"),t=S("img"),this.h()},l(u){e=E(u,"DIV",{class:!0});var f=P(e);t=E(f,"IMG",{class:!0,loading:!0,"data-src":!0,alt:!0,style:!0,width:!0,height:!0,tabindex:!0}),f.forEach(h),this.h()},h(){c(t,"class","post-media svelte-mhr4k8"),c(t,"loading","lazy"),c(t,"data-src",s[2]),c(t,"alt",l=s[0].id.toString()),c(t,"style",n=`aspect-ratio: ${s[0].width} / ${s[0].height}`),c(t,"width",o=s[0].width),c(t,"height",r=s[0].height),c(t,"tabindex","0"),c(e,"class","svelte-mhr4k8"),z(e,"expandable",s[3]),z(e,"open",s[1])},m(u,f){I(u,e,f),M(e,t),i||(a=[D(t,"click",s[4]),D(t,"keydown",Le),D(t,"error",s[5],{once:!0}),Ne(Ve.call(null,t))],i=!0)},p(u,[f]){f&4&&c(t,"data-src",u[2]),f&1&&l!==(l=u[0].id.toString())&&c(t,"alt",l),f&1&&n!==(n=`aspect-ratio: ${u[0].width} / ${u[0].height}`)&&c(t,"style",n),f&1&&o!==(o=u[0].width)&&c(t,"width",o),f&1&&r!==(r=u[0].height)&&c(t,"height",r),f&2&&z(e,"open",u[1])},i:k,o:k,d(u){u&&h(e),i=!1,ce(a)}}}function Bt(s,e,t){let l,{post:n}=e;const r=n.width/n.height<.33;let i;const a=()=>t(1,i=!i),u=f=>f.target.src=`${ee}/assets/failed-to-load.svg`;return s.$$set=f=>{"post"in f&&t(0,n=f.post)},s.$$.update=()=>{s.$$.dirty&1&&t(2,l=ct?n.file_url:n.sample_url)},[n,i,l,r,a,u]}class bs extends G{constructor(e){super(),R(this,e,Bt,zt,V,{post:0})}}const Se=s=>{if(typeof s!="number")throw new TypeError(`Attempted to call formatVideoTime with invalid value: ${s}`);const e=Math.floor(s),t=e%60,l=Math.floor(e/60);return`${Ee(l)}:${Ee(t)}`},Ee=s=>{const e=String(s),t=Math.max(0,2-e.length);return`${"0".repeat(t)}${e}`};function jt(s){let e,t;return{c(){e=S("img"),this.h()},l(l){e=E(l,"IMG",{src:!0,alt:!0,width:!0,height:!0,style:!0}),this.h()},h(){Q(e.src,t=ee+"/assets/play.svg")||c(e,"src",t),c(e,"alt","Start GIF"),c(e,"width","16"),c(e,"height","32"),oe(e,"margin-left","4px")},m(l,n){I(l,e,n)},d(l){l&&h(e)}}}function qt(s){let e,t;return{c(){e=S("img"),this.h()},l(l){e=E(l,"IMG",{src:!0,alt:!0,width:!0,height:!0}),this.h()},h(){Q(e.src,t=ee+"/assets/pause.svg")||c(e,"src",t),c(e,"alt","Stop GIF"),c(e,"width","16"),c(e,"height","32")},m(l,n){I(l,e,n)},d(l){l&&h(e)}}}function Kt(s){let e,t;return{c(){e=S("img"),this.h()},l(l){e=E(l,"IMG",{src:!0,alt:!0,width:!0,height:!0}),this.h()},h(){Q(e.src,t=ee+"/assets/load.svg")||c(e,"src",t),c(e,"alt","Loading GIF"),c(e,"width","16"),c(e,"height","32")},m(l,n){I(l,e,n)},d(l){l&&h(e)}}}function Wt(s){let e,t,l,n;function o(a,u){return a[1]?Kt:a[0]?qt:jt}let r=o(s),i=r(s);return{c(){e=S("button"),i.c(),this.h()},l(a){e=E(a,"BUTTON",{type:!0,class:!0});var u=P(e);i.l(u),u.forEach(h),this.h()},h(){c(e,"type","button"),c(e,"class",t=ue(s[2].class)+" svelte-106eyjk")},m(a,u){I(a,e,u),i.m(e,null),l||(n=D(e,"click",s[3]),l=!0)},p(a,[u]){r!==(r=o(a))&&(i.d(1),i=r(a),i&&(i.c(),i.m(e,null))),u&4&&t!==(t=ue(a[2].class)+" svelte-106eyjk")&&c(e,"class",t)},i:k,o:k,d(a){a&&h(e),i.d(),l=!1,n()}}}function Ht(s,e,t){let{playing:l}=e,{loading:n}=e;function o(r){De.call(this,s,r)}return s.$$set=r=>{t(2,e=te(te({},e),se(r))),"playing"in r&&t(0,l=r.playing),"loading"in r&&t(1,n=r.loading)},e=se(e),[l,n,e,o]}class Ge extends G{constructor(e){super(),R(this,e,Ht,Wt,V,{playing:0,loading:1})}}function Ae(s){let e,t,l,n=!0,o=!1,r,i,a,u=Se(s[16])+"",f,A,m,w,g,T,p,d,N;function y(){cancelAnimationFrame(r),e.paused||(r=rt(y),o=!0),s[24].call(e)}return T=new Ge({props:{playing:s[5],loading:s[6],class:`center hidable ${s[13]?"hide":""}`}}),T.$on("click",s[19]),{c(){e=S("video"),i=B(),a=S("span"),f=U(u),A=B(),m=S("input"),g=B(),Z(T.$$.fragment),this.h()},l(_){e=E(_,"VIDEO",{tabindex:!0,poster:!0,src:!0,preload:!0,style:!0,class:!0}),P(e).forEach(h),i=j(_),a=E(_,"SPAN",{class:!0});var v=P(a);f=F(v,u),v.forEach(h),A=j(_),m=E(_,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0,style:!0}),g=j(_),Y(T.$$.fragment,_),this.h()},h(){c(e,"tabindex","0"),c(e,"poster",s[1]),e.loop=s[4],Q(e.src,t=s[0])||c(e,"src",t),c(e,"preload","metadata"),c(e,"style",l=`aspect-ratio: ${s[2]} / ${s[3]}`),c(e,"class","svelte-18n7cnr"),s[8]===void 0&&et(()=>s[25].call(e)),c(a,"class","hidable svelte-18n7cnr"),z(a,"hide",s[10]),c(m,"type","range"),c(m,"min",0),c(m,"max",s[8]),c(m,"step",.0166666),c(m,"class","hidable svelte-18n7cnr"),c(m,"style",w=`background-image: linear-gradient(90deg, var(--accent) ${s[14]}%, var(--background-2) ${s[14]}%);}`),z(m,"hide",s[13])},m(_,v){I(_,e,v),s[22](e),I(_,i,v),I(_,a,v),M(a,f),I(_,A,v),I(_,m,v),fe(m,s[7]),I(_,g,v),x(T,_,v),p=!0,d||(N=[D(e,"play",s[23]),D(e,"pause",s[23]),D(e,"timeupdate",y),D(e,"durationchange",s[25]),D(e,"waiting",s[26]),D(e,"playing",s[27]),D(e,"pause",s[28]),D(e,"ended",s[29]),D(e,"click",s[20]),D(e,"dblclick",tt(st(s[17]))),D(m,"change",s[30]),D(m,"input",s[30])],d=!0)},p(_,v){(!p||v[0]&2)&&c(e,"poster",_[1]),(!p||v[0]&16)&&(e.loop=_[4]),(!p||v[0]&1&&!Q(e.src,t=_[0]))&&c(e,"src",t),(!p||v[0]&12&&l!==(l=`aspect-ratio: ${_[2]} / ${_[3]}`))&&c(e,"style",l),v[0]&32768&&n!==(n=_[15])&&e[n?"pause":"play"](),!o&&v[0]&128&&!isNaN(_[7])&&(e.currentTime=_[7]),o=!1,(!p||v[0]&65536)&&u!==(u=Se(_[16])+"")&&O(f,u),(!p||v[0]&1024)&&z(a,"hide",_[10]),(!p||v[0]&256)&&c(m,"max",_[8]),(!p||v[0]&16384&&w!==(w=`background-image: linear-gradient(90deg, var(--accent) ${_[14]}%, var(--background-2) ${_[14]}%);}`))&&c(m,"style",w),v[0]&128&&fe(m,_[7]),(!p||v[0]&8192)&&z(m,"hide",_[13]);const q={};v[0]&32&&(q.playing=_[5]),v[0]&64&&(q.loading=_[6]),v[0]&8192&&(q.class=`center hidable ${_[13]?"hide":""}`),T.$set(q)},i(_){p||(C(T.$$.fragment,_),p=!0)},o(_){L(T.$$.fragment,_),p=!1},d(_){_&&(h(e),h(i),h(a),h(A),h(m),h(g)),s[22](null),$(T,_),d=!1,ce(N)}}}function Jt(s){let e,t,l,n,o,r=s[9]&&Ae(s);return{c(){e=S("div"),r&&r.c(),this.h()},l(i){e=E(i,"DIV",{class:!0,style:!0});var a=P(e);r&&r.l(a),a.forEach(h),this.h()},h(){c(e,"class",t="post-media player "+s[21].class+" svelte-18n7cnr"),oe(e,"aspect-ratio",s[2]+"/"+s[3])},m(i,a){I(i,e,a),r&&r.m(e,null),s[31](e),l=!0,n||(o=D(e,"keydown",s[18]),n=!0)},p(i,a){i[9]?r?(r.p(i,a),a[0]&512&&C(r,1)):(r=Ae(i),r.c(),C(r,1),r.m(e,null)):r&&(re(),L(r,1,1,()=>{r=null}),ae()),(!l||a[0]&2097152&&t!==(t="post-media player "+i[21].class+" svelte-18n7cnr"))&&c(e,"class",t),(!l||a[0]&12)&&oe(e,"aspect-ratio",i[2]+"/"+i[3])},i(i){l||(C(r),l=!0)},o(i){L(r),l=!1},d(i){i&&h(e),r&&r.d(),s[31](null),n=!1,o()}}}const Ie=5;function Qt(s,e,t){let l,n,o,r,{src:i}=e,{poster:a}=e,{width:u}=e,{height:f}=e,{loop:A}=e,m,w,g=!1,T=!1,p=0,d=0,N=!1,y=!1;const _=()=>{t(7,p=Math.max(0,p-Ie))},v=()=>{t(7,p=Math.min(d,p+Ie))},q=b=>{b.offsetX<b.target.clientWidth/2?_():v()},Re=b=>{Ce(b)||b.key==="k"?(b.preventDefault(),t(5,g=!g)):b.key==="ArrowLeft"||b.key==="j"?_():(b.key==="ArrowRight"||b.key==="l")&&v()},K=new IntersectionObserver(b=>{for(const Xe of b)Xe.isIntersecting?t(9,N=!0):w&&(t(5,g=!1),t(6,T=!1),w.addEventListener("error",()=>{t(9,N=!1)},{once:!0}),t(12,w.src="",w))},{rootMargin:"0px"}),Ue=()=>{t(5,g=!g),t(6,T=!0),t(10,y=g)},Fe=()=>{t(10,y=!y)};xe(()=>K==null?void 0:K.observe(m)),$e(()=>K==null?void 0:K.unobserve(m));function Oe(b){X[b?"unshift":"push"](()=>{w=b,t(12,w)})}function ze(){n=this.paused,t(15,n),t(5,g),t(9,N)}function Be(){p=this.currentTime,t(7,p)}function je(){d=this.duration,t(8,d)}const qe=()=>t(6,T=!0),Ke=()=>t(6,T=!1),We=()=>t(6,T=!1),He=()=>{A||(t(6,T=!1),t(5,g=!1))};function Je(){p=nt(this.value),t(7,p)}function Qe(b){X[b?"unshift":"push"](()=>{m=b,t(11,m)})}return s.$$set=b=>{t(21,e=te(te({},e),se(b))),"src"in b&&t(0,i=b.src),"poster"in b&&t(1,a=b.poster),"width"in b&&t(2,u=b.width),"height"in b&&t(3,f=b.height),"loop"in b&&t(4,A=b.loop)},s.$$.update=()=>{s.$$.dirty[0]&384&&t(16,l=d-p),s.$$.dirty[0]&544&&t(5,g=N&&g),s.$$.dirty[0]&32&&t(15,n=!g),s.$$.dirty[0]&384&&t(14,o=p/d*98+1),s.$$.dirty[0]&1120&&t(13,r=g&&!T&&y)},e=se(e),[i,a,u,f,A,g,T,p,d,N,y,m,w,r,o,n,l,q,Re,Ue,Fe,e,Oe,ze,Be,je,qe,Ke,We,He,Je,Qe]}class vs extends G{constructor(e){super(),R(this,e,Qt,Jt,V,{src:0,poster:1,width:2,height:3,loop:4},null,[-1,-1])}}function Xt(s){let e,t,l,n,o,r,i,a,u,f,A,m,w;function g(d){s[13](d)}function T(d){s[14](d)}let p={class:"center"};return s[2]!==void 0&&(p.playing=s[2]),s[3]!==void 0&&(p.loading=s[3]),i=new Ge({props:p}),X.push(()=>de(i,"playing",g)),X.push(()=>de(i,"loading",T)),i.$on("click",s[15]),{c(){e=S("div"),t=S("img"),r=B(),Z(i.$$.fragment),this.h()},l(d){e=E(d,"DIV",{class:!0,style:!0});var N=P(e);t=E(N,"IMG",{class:!0,loading:!0,"data-src":!0,alt:!0,width:!0,height:!0,tabindex:!0}),r=j(N),Y(i.$$.fragment,N),N.forEach(h),this.h()},h(){c(t,"class","post-media media-img svelte-158nmsy"),c(t,"loading","lazy"),c(t,"data-src",s[4]),c(t,"alt",l=s[0].id.toString()),c(t,"width",n=s[0].width),c(t,"height",o=s[0].height),c(t,"tabindex","0"),c(e,"class","container svelte-158nmsy"),c(e,"style",f=`aspect-ratio: ${s[0].width} / ${s[0].height}`)},m(d,N){I(d,e,N),M(e,t),s[9](t),M(e,r),x(i,e,null),A=!0,m||(w=[D(t,"click",s[8]),D(t,"keydown",s[10]),D(t,"load",s[11]),D(t,"error",s[12],{once:!0}),Ne(Ve.call(null,t))],m=!0)},p(d,[N]){(!A||N&16)&&c(t,"data-src",d[4]),(!A||N&1&&l!==(l=d[0].id.toString()))&&c(t,"alt",l),(!A||N&1&&n!==(n=d[0].width))&&c(t,"width",n),(!A||N&1&&o!==(o=d[0].height))&&c(t,"height",o);const y={};!a&&N&4&&(a=!0,y.playing=d[2],he(()=>a=!1)),!u&&N&8&&(u=!0,y.loading=d[3],he(()=>u=!1)),i.$set(y),(!A||N&1&&f!==(f=`aspect-ratio: ${d[0].width} / ${d[0].height}`))&&c(e,"style",f)},i(d){A||(C(i.$$.fragment,d),A=!0)},o(d){L(i.$$.fragment,d),A=!1},d(d){d&&h(e),s[9](null),$(i),m=!1,ce(w)}}}function Zt(s,e,t){let l,n,o,r,{post:i}=e,a,u=!1,f=!1;function A(y){De.call(this,s,y)}function m(y){X[y?"unshift":"push"](()=>{a=y,t(1,a),t(2,u),t(6,n),t(5,o),t(7,l),t(0,i)})}const w=y=>{Le(y),Ce(y)&&(y.preventDefault(),t(3,f=!0),t(2,u=!u))},g=()=>t(3,f=!1),T=y=>{t(3,f=!1),y.target.src=`${ee}/assets/failed-to-load.svg`};function p(y){u=y,t(2,u)}function d(y){f=y,t(3,f)}const N=()=>{t(3,f=!0),t(2,u=!u)};return s.$$set=y=>{"post"in y&&t(0,i=y.post)},s.$$.update=()=>{s.$$.dirty&1&&t(7,l=Ut(i.file_url,i.sample_url,i.preview_url)),s.$$.dirty&128&&t(6,n=l.animated),s.$$.dirty&128&&t(5,o=l.static),s.$$.dirty&100&&t(4,r=u?n:o),s.$$.dirty&102&&a&&t(1,a.src=u?n:o,a)},[i,a,u,f,r,o,n,l,A,m,w,g,T,p,d,N]}class ks extends G{constructor(e){super(),R(this,e,Zt,Xt,V,{post:0})}}export{os as C,hs as E,ks as G,bs as I,_s as K,ms as P,cs as R,fs as S,vs as V,us as a,ds as b,gs as c,Ft as d,ps as e,Ut as g,ys as i};
