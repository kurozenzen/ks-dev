import{s as L,f as S,l as G,a as O,g as E,h as M,m as j,d as h,c as B,j as c,i as I,u as D,n as U,v as k,e as J,I as Te,D as Qe,y as Ye,z as F,H as N,S as Ne,J as ce,r as ue,T as te,U as se,N as De,K as X,k as oe,o as xe,M as $e,V as et,G as fe,L as tt,R as st,p as Z,P as nt,E as he}from"./scheduler.876e21ab.js";import{S as V,i as R,a as P,g as ae,c as re,t as C,b as Q,d as Y,m as x,e as $,r as lt,f as _e}from"./index.bf870a3d.js";import{f as de}from"./format-tag.7e313273.js";import{i as at}from"./tags.49324235.js";import{e as ne}from"./each.e59479a4.js";import{a as ie}from"./active-tags-store.9b7ddb3d.js";import{S as rt}from"./SimpleTag.683d0997.js";import{h as ge,u as it}from"./await_block.ac7187f4.js";import{L as ot}from"./LoadingAnimation.a4beb55c.js";import{b as ee}from"./paths.4aa6f1c5.js";import{h as ct}from"./always-loop-store.309dbd9e.js";const ut="https://api.rule34.xxx/index.php?page=dapi&s=comment&q=index&json=1",me=async(s=void 0)=>{if(typeof s!="number"&&s!==void 0)throw new TypeError("Invalid postId");const e=new URL(ut);s!==void 0&&e.searchParams.append("post_id",String(s));const t=await fetch(e);if(!t.ok)throw new Error("Failed to get tag suggestions");const l=await t.text(),o=new DOMParser().parseFromString(l,"text/xml"),a=[];for(const i of o.getElementsByTagName("comment"))a.push(ft(i.attributes));return a},ft=s=>{const e=s.getNamedItem("creator"),t=s.getNamedItem("created_at"),l=s.getNamedItem("body");if(e==null||t==null||l==null)throw new Error(`Failed to parse comment, attribute was null. ${e}, ${t}, ${l}`);return{author:e.value,createdAt:t.value,content:l.value}},pe=6e4,le=s=>{if(!ht(s))throw new TypeError("Invalid createdAt passed to formatCreatedAt");const e=new Date(s).getTime()/pe,l=new Date().getTime()/pe-e;if(l<1)return"just now";if(l<60)return H(l,"minute");const n=l/60;if(n<24)return H(n,"hour");const o=n/24;if(o<7)return H(o,"day");if(o<30.5)return H(o/7,"week");if(o<365.25)return H(o/30.5,"month");const a=o/365.25;return H(a,"year")},ht=s=>(typeof s=="number"||typeof s=="string")&&new Date(s).toString()!=="Invalid Date",H=(s,e)=>{const t=s.toFixed();return`${t} ${e}${t==="1"?"":"s"} ago`};function _t(s){let e,t,l=s[0].author+"",n,o,a,i=le(s[0].createdAt)+"",r,u,f,A=s[0].content+"",m;return{c(){e=S("div"),t=S("span"),n=G(l),o=O(),a=S("span"),r=G(i),u=O(),f=S("span"),m=G(A),this.h()},l(w){e=E(w,"DIV",{class:!0});var p=M(e);t=E(p,"SPAN",{class:!0});var T=M(t);n=j(T,l),T.forEach(h),o=B(p),a=E(p,"SPAN",{class:!0});var b=M(a);r=j(b,i),b.forEach(h),u=B(p),f=E(p,"SPAN",{class:!0});var g=M(f);m=j(g,A),g.forEach(h),p.forEach(h),this.h()},h(){c(t,"class","author svelte-bys59y"),c(a,"class","created-at svelte-bys59y"),c(f,"class","content svelte-bys59y"),c(e,"class","svelte-bys59y")},m(w,p){I(w,e,p),D(e,t),D(t,n),D(e,o),D(e,a),D(a,r),D(e,u),D(e,f),D(f,m)},p(w,[p]){p&1&&l!==(l=w[0].author+"")&&U(n,l),p&1&&i!==(i=le(w[0].createdAt)+"")&&U(r,i),p&1&&A!==(A=w[0].content+"")&&U(m,A)},i:k,o:k,d(w){w&&h(e)}}}function dt(s,e,t){let{comment:l}=e;return s.$$set=n=>{"comment"in n&&t(0,l=n.comment)},[l]}class gt extends V{constructor(e){super(),R(this,e,dt,_t,L,{comment:0})}}function mt(s){let e,t=s[0].charAt(0).toUpperCase()+"",l,n;return{c(){e=S("span"),l=G(t),this.h()},l(o){e=E(o,"SPAN",{title:!0,class:!0});var a=M(e);l=j(a,t),a.forEach(h),this.h()},h(){c(e,"title",n="Rated "+s[0]+"."),c(e,"class","svelte-1nbj6kf")},m(o,a){I(o,e,a),D(e,l)},p(o,[a]){a&1&&t!==(t=o[0].charAt(0).toUpperCase()+"")&&U(l,t),a&1&&n!==(n="Rated "+o[0]+".")&&c(e,"title",n)},i:k,o:k,d(o){o&&h(e)}}}function pt(s,e,t){let{value:l}=e;return s.$$set=n=>{"value"in n&&t(0,l=n.value)},[l]}class os extends V{constructor(e){super(),R(this,e,pt,mt,L,{value:0})}}function bt(s){let e,t=le(s[0])+"",l;return{c(){e=S("span"),l=G(t),this.h()},l(n){e=E(n,"SPAN",{class:!0});var o=M(e);l=j(o,t),o.forEach(h),this.h()},h(){c(e,"class","svelte-1vqihm9")},m(n,o){I(n,e,o),D(e,l)},p(n,[o]){o&1&&t!==(t=le(n[0])+"")&&U(l,t)},i:k,o:k,d(n){n&&h(e)}}}function yt(s,e,t){let{value:l}=e;return s.$$set=n=>{"value"in n&&t(0,l=n.value)},[l]}class cs extends V{constructor(e){super(),R(this,e,yt,bt,L,{value:0})}}function vt(s){let e,t=de(s[0])+"",l;return{c(){e=S("span"),l=G(t),this.h()},l(n){e=E(n,"SPAN",{"data-testid":!0,class:!0});var o=M(e);l=j(o,t),o.forEach(h),this.h()},h(){c(e,"data-testid","score"),c(e,"class","codicon codicon-heart svelte-te86f3")},m(n,o){I(n,e,o),D(e,l)},p(n,[o]){o&1&&t!==(t=de(n[0])+"")&&U(l,t)},i:k,o:k,d(n){n&&h(e)}}}function kt(s,e,t){let{value:l}=e;return s.$$set=n=>{"value"in n&&t(0,l=n.value)},[l]}class us extends V{constructor(e){super(),R(this,e,kt,vt,L,{value:0})}}function be(s){let e,t,l,n,o;return{c(){e=S("a"),t=S("i"),l=O(),n=G(s[1]),this.h()},l(a){e=E(a,"A",{href:!0,target:!0,class:!0});var i=M(e);t=E(i,"I",{class:!0}),M(t).forEach(h),l=B(i),n=j(i,s[1]),i.forEach(h),this.h()},h(){c(t,"class","codicon codicon-link"),c(e,"href",o=s[0].toString()),c(e,"target","_newtab"),c(e,"class","svelte-1orztco")},m(a,i){I(a,e,i),D(e,t),D(e,l),D(e,n)},p(a,i){i&2&&U(n,a[1]),i&1&&o!==(o=a[0].toString())&&c(e,"href",o)},d(a){a&&h(e)}}}function wt(s){let e,t=s[0]&&be(s);return{c(){t&&t.c(),e=J()},l(l){t&&t.l(l),e=J()},m(l,n){t&&t.m(l,n),I(l,e,n)},p(l,[n]){l[0]?t?t.p(l,n):(t=be(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:k,o:k,d(l){l&&h(e),t&&t.d(l)}}}function St(s,e,t){let l,n,{source:o}=e;return s.$$set=a=>{"source"in a&&t(2,o=a.source)},s.$$.update=()=>{var a;s.$$.dirty&4&&t(0,l=at(o)?new URL(o):null),s.$$.dirty&1&&t(1,n=(a=l==null?void 0:l.hostname)==null?void 0:a.replace(/^www./,""))},[l,n,o]}class fs extends V{constructor(e){super(),R(this,e,St,wt,L,{source:2})}}function Et(s){let e,t;return{c(){e=S("a"),t=G("Open"),this.h()},l(l){e=E(l,"A",{href:!0,target:!0,class:!0});var n=M(e);t=j(n,"Open"),n.forEach(h),this.h()},h(){c(e,"href",s[0]),c(e,"target","_newtab"),c(e,"class","codicon codicon-link-external svelte-10flxu9")},m(l,n){I(l,e,n),D(e,t)},p(l,[n]){n&1&&c(e,"href",l[0])},i:k,o:k,d(l){l&&h(e)}}}function At(s,e,t){let{url:l}=e;return s.$$set=n=>{"url"in n&&t(0,l=n.url)},[l]}class hs extends V{constructor(e){super(),R(this,e,At,Et,L,{url:0})}}function It(s){let e,t,l;return{c(){e=S("a"),t=S("i"),l=G(" File"),this.h()},l(n){e=E(n,"A",{href:!0,target:!0,class:!0});var o=M(e);t=E(o,"I",{class:!0}),M(t).forEach(h),l=j(o," File"),o.forEach(h),this.h()},h(){c(t,"class","codicon codicon-file"),c(e,"href",s[0]),c(e,"target","_newtab"),c(e,"class","svelte-1orztco")},m(n,o){I(n,e,o),D(e,t),D(e,l)},p(n,[o]){o&1&&c(e,"href",n[0])},i:k,o:k,d(n){n&&h(e)}}}function Tt(s,e,t){let{url:l}=e;return s.$$set=n=>{"url"in n&&t(0,l=n.url)},[l]}class _s extends V{constructor(e){super(),R(this,e,Tt,It,L,{url:0})}}function ye(s,e,t){const l=s.slice();l[4]=e[t];const n=l[1].find(function(...a){return s[3](l[4],...a)})!==void 0;return l[5]=n,l}function ve(s){let e,t;function l(){return s[2](s[5],s[4])}return e=new rt({props:{tag:s[4],active:s[5]}}),e.$on("click",l),{c(){Q(e.$$.fragment)},l(n){Y(e.$$.fragment,n)},m(n,o){x(e,n,o),t=!0},p(n,o){s=n;const a={};o&1&&(a.tag=s[4]),o&3&&(a.active=s[5]),e.$set(a)},i(n){t||(P(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){$(e,n)}}}function Nt(s){let e,t,l=ne(s[0]),n=[];for(let a=0;a<l.length;a+=1)n[a]=ve(ye(s,l,a));const o=a=>C(n[a],1,1,()=>{n[a]=null});return{c(){e=S("ul");for(let a=0;a<n.length;a+=1)n[a].c();this.h()},l(a){e=E(a,"UL",{class:!0});var i=M(e);for(let r=0;r<n.length;r+=1)n[r].l(i);i.forEach(h),this.h()},h(){c(e,"class","tags svelte-b5q4us")},m(a,i){I(a,e,i);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null);t=!0},p(a,[i]){if(i&3){l=ne(a[0]);let r;for(r=0;r<l.length;r+=1){const u=ye(a,l,r);n[r]?(n[r].p(u,i),P(n[r],1)):(n[r]=ve(u),n[r].c(),P(n[r],1),n[r].m(e,null))}for(ae(),r=l.length;r<n.length;r+=1)o(r);re()}},i(a){if(!t){for(let i=0;i<l.length;i+=1)P(n[i]);t=!0}},o(a){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)C(n[i]);t=!1},d(a){a&&h(e),Te(n,a)}}}function Dt(s,e,t){let l;Qe(s,ie,i=>t(1,l=i));let{tags:n}=e;const o=(i,r)=>i?ie.removeByName(r.name):ie.addOrReplace({...r,modifier:"+"}),a=(i,r)=>r.name===i.name;return s.$$set=i=>{"tags"in i&&t(0,n=i.tags)},[n,l,o,a]}class ds extends V{constructor(e){super(),R(this,e,Dt,Nt,L,{tags:0})}}const Me=s=>s.endsWith(".gif"),Mt=(s,e,t)=>Me(e)?{static:t,animated:e}:{static:e,animated:s},Pe=s=>s.endsWith(".mp4")||s.endsWith(".webm"),gs=(s,e,t)=>Pe(e)?{static:t,animated:e}:{static:e,animated:s},ms=s=>s.some(e=>e.name==="loop"),ps=s=>Me(s)||Pe(s),Ce=s=>(s==null?void 0:s.key)===" ",Pt=s=>(s==null?void 0:s.key)==="Enter",Le=s=>{var e,t;Pt(s)&&((t=(e=s.target)==null?void 0:e.click)==null||t.call(e))};function ke(s,e,t){const l=s.slice();return l[2]=e[t],l}function Ct(s){return{c:k,l:k,m:k,p:k,i:k,o:k,d:k}}function Lt(s){let e,t,l,n;const o=[Rt,Vt],a=[];function i(r,u){return r[1].length>0?0:1}return e=i(s),t=a[e]=o[e](s),{c(){t.c(),l=J()},l(r){t.l(r),l=J()},m(r,u){a[e].m(r,u),I(r,l,u),n=!0},p(r,u){let f=e;e=i(r),e===f?a[e].p(r,u):(ae(),C(a[f],1,1,()=>{a[f]=null}),re(),t=a[e],t?t.p(r,u):(t=a[e]=o[e](r),t.c()),P(t,1),t.m(l.parentNode,l))},i(r){n||(P(t),n=!0)},o(r){C(t),n=!1},d(r){r&&h(l),a[e].d(r)}}}function Vt(s){let e,t="Comments for this post are not available. <br/>This can happen if comments have been deleted.";return{c(){e=S("p"),e.innerHTML=t,this.h()},l(l){e=E(l,"P",{class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-1f9q9vq"&&(e.innerHTML=t),this.h()},h(){c(e,"class","no-comments svelte-x6zn2h")},m(l,n){I(l,e,n)},p:k,i:k,o:k,d(l){l&&h(e)}}}function Rt(s){let e,t,l=ne(s[1]),n=[];for(let a=0;a<l.length;a+=1)n[a]=we(ke(s,l,a));const o=a=>C(n[a],1,1,()=>{n[a]=null});return{c(){e=S("ul");for(let a=0;a<n.length;a+=1)n[a].c();this.h()},l(a){e=E(a,"UL",{class:!0});var i=M(e);for(let r=0;r<n.length;r+=1)n[r].l(i);i.forEach(h),this.h()},h(){c(e,"class","comments svelte-x6zn2h")},m(a,i){I(a,e,i);for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(e,null);t=!0},p(a,i){if(i&1){l=ne(a[1]);let r;for(r=0;r<l.length;r+=1){const u=ke(a,l,r);n[r]?(n[r].p(u,i),P(n[r],1)):(n[r]=we(u),n[r].c(),P(n[r],1),n[r].m(e,null))}for(ae(),r=l.length;r<n.length;r+=1)o(r);re()}},i(a){if(!t){for(let i=0;i<l.length;i+=1)P(n[i]);t=!0}},o(a){n=n.filter(Boolean);for(let i=0;i<n.length;i+=1)C(n[i]);t=!1},d(a){a&&h(e),Te(n,a)}}}function we(s){let e,t;return e=new gt({props:{comment:s[2]}}),{c(){Q(e.$$.fragment)},l(l){Y(e.$$.fragment,l)},m(l,n){x(e,l,n),t=!0},p(l,n){const o={};n&1&&(o.comment=l[2]),e.$set(o)},i(l){t||(P(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){$(e,l)}}}function zt(s){let e,t;return e=new ot({}),{c(){Q(e.$$.fragment)},l(l){Y(e.$$.fragment,l)},m(l,n){x(e,l,n),t=!0},p:k,i(l){t||(P(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){$(e,l)}}}function Gt(s){let e,t,l,n={ctx:s,current:null,token:null,hasCatch:!1,pending:zt,then:Lt,catch:Ct,value:1,blocks:[,,,]};return ge(t=me(s[0].id),n),{c(){e=J(),n.block.c()},l(o){e=J(),n.block.l(o)},m(o,a){I(o,e,a),n.block.m(o,n.anchor=a),n.mount=()=>e.parentNode,n.anchor=e,l=!0},p(o,[a]){s=o,n.ctx=s,a&1&&t!==(t=me(s[0].id))&&ge(t,n)||it(n,s,a)},i(o){l||(P(n.block),l=!0)},o(o){for(let a=0;a<3;a+=1){const i=n.blocks[a];C(i)}l=!1},d(o){o&&h(e),n.block.d(o),n.token=null,n=null}}}function jt(s,e,t){let{post:l}=e;return s.$$set=n=>{"post"in n&&t(0,l=n.post)},[l]}class bs extends V{constructor(e){super(),R(this,e,jt,Gt,L,{post:0})}}const Ut="1250px",W=new IntersectionObserver(s=>{var e;for(const t of s){const l=t.isIntersecting?t.target.getAttribute("data-src")??"":"";(e=t==null?void 0:t.target)==null||e.setAttribute("src",l)}},{rootMargin:Ut}),Ve=s=>(W==null||W.observe(s),{destroy(){W==null||W.unobserve(s)}});function Ft(s){let e,t,l,n,o,a,i,r;return{c(){e=S("div"),t=S("img"),this.h()},l(u){e=E(u,"DIV",{class:!0});var f=M(e);t=E(f,"IMG",{class:!0,loading:!0,"data-src":!0,alt:!0,style:!0,width:!0,height:!0,tabindex:!0}),f.forEach(h),this.h()},h(){c(t,"class","post-media svelte-1v9pjvd"),c(t,"loading","lazy"),c(t,"data-src",s[2]),c(t,"alt",l=s[0].id.toString()),c(t,"style",n=`aspect-ratio: ${s[0].width} / ${s[0].height}`),c(t,"width",o=s[0].width),c(t,"height",a=s[0].height),c(t,"tabindex","0"),c(e,"class","svelte-1v9pjvd"),F(e,"expandable",s[3]),F(e,"open",s[1])},m(u,f){I(u,e,f),D(e,t),i||(r=[N(t,"click",s[4]),N(t,"keydown",Le),N(t,"error",s[5],{once:!0}),Ne(Ve.call(null,t))],i=!0)},p(u,[f]){f&4&&c(t,"data-src",u[2]),f&1&&l!==(l=u[0].id.toString())&&c(t,"alt",l),f&1&&n!==(n=`aspect-ratio: ${u[0].width} / ${u[0].height}`)&&c(t,"style",n),f&1&&o!==(o=u[0].width)&&c(t,"width",o),f&1&&a!==(a=u[0].height)&&c(t,"height",a),f&2&&F(e,"open",u[1])},i:k,o:k,d(u){u&&h(e),i=!1,ce(r)}}}function Ot(s,e,t){let l,{post:n}=e;const a=n.width/n.height<.33;let i;const r=()=>t(1,i=!i),u=f=>f.target.src=`${ee}/assets/failed-to-load.svg`;return s.$$set=f=>{"post"in f&&t(0,n=f.post)},s.$$.update=()=>{s.$$.dirty&1&&t(2,l=ct?n.file_url:n.sample_url)},[n,i,l,a,r,u]}class ys extends V{constructor(e){super(),R(this,e,Ot,Ft,L,{post:0})}}const Se=s=>{if(typeof s!="number")throw new TypeError(`Attempted to call formatVideoTime with invalid value: ${s}`);const e=Math.floor(s),t=e%60,l=Math.floor(e/60);return`${Ee(l)}:${Ee(t)}`},Ee=s=>{const e=String(s),t=Math.max(0,2-e.length);return`${"0".repeat(t)}${e}`};function Bt(s){let e,t;return{c(){e=S("img"),this.h()},l(l){e=E(l,"IMG",{src:!0,alt:!0,width:!0,height:!0,style:!0}),this.h()},h(){X(e.src,t=ee+"/assets/play.svg")||c(e,"src",t),c(e,"alt","Start GIF"),c(e,"width","16"),c(e,"height","32"),oe(e,"margin-left","4px")},m(l,n){I(l,e,n)},d(l){l&&h(e)}}}function qt(s){let e,t;return{c(){e=S("img"),this.h()},l(l){e=E(l,"IMG",{src:!0,alt:!0,width:!0,height:!0}),this.h()},h(){X(e.src,t=ee+"/assets/pause.svg")||c(e,"src",t),c(e,"alt","Stop GIF"),c(e,"width","16"),c(e,"height","32")},m(l,n){I(l,e,n)},d(l){l&&h(e)}}}function Kt(s){let e,t;return{c(){e=S("img"),this.h()},l(l){e=E(l,"IMG",{src:!0,alt:!0,width:!0,height:!0}),this.h()},h(){X(e.src,t=ee+"/assets/load.svg")||c(e,"src",t),c(e,"alt","Loading GIF"),c(e,"width","16"),c(e,"height","32")},m(l,n){I(l,e,n)},d(l){l&&h(e)}}}function Ht(s){let e,t,l,n;function o(r,u){return r[1]?Kt:r[0]?qt:Bt}let a=o(s),i=a(s);return{c(){e=S("button"),i.c(),this.h()},l(r){e=E(r,"BUTTON",{type:!0,class:!0});var u=M(e);i.l(u),u.forEach(h),this.h()},h(){c(e,"type","button"),c(e,"class",t=ue(s[2].class)+" svelte-1hltap9")},m(r,u){I(r,e,u),i.m(e,null),l||(n=N(e,"click",s[3]),l=!0)},p(r,[u]){a!==(a=o(r))&&(i.d(1),i=a(r),i&&(i.c(),i.m(e,null))),u&4&&t!==(t=ue(r[2].class)+" svelte-1hltap9")&&c(e,"class",t)},i:k,o:k,d(r){r&&h(e),i.d(),l=!1,n()}}}function Wt(s,e,t){let{playing:l}=e,{loading:n}=e;function o(a){De.call(this,s,a)}return s.$$set=a=>{t(2,e=te(te({},e),se(a))),"playing"in a&&t(0,l=a.playing),"loading"in a&&t(1,n=a.loading)},e=se(e),[l,n,e,o]}class Re extends V{constructor(e){super(),R(this,e,Wt,Ht,L,{playing:0,loading:1})}}function Ae(s){let e,t,l,n=!0,o=!1,a,i,r,u=Se(s[16])+"",f,A,m,w,p,T,b,g,d;function z(){cancelAnimationFrame(a),e.paused||(a=lt(z),o=!0),s[24].call(e)}return T=new Re({props:{playing:s[5],loading:s[6],class:`center hidable ${s[13]?"hide":""}`}}),T.$on("click",s[19]),{c(){e=S("video"),i=O(),r=S("span"),f=G(u),A=O(),m=S("input"),p=O(),Q(T.$$.fragment),this.h()},l(_){e=E(_,"VIDEO",{tabindex:!0,poster:!0,src:!0,preload:!0,style:!0,class:!0}),M(e).forEach(h),i=B(_),r=E(_,"SPAN",{class:!0});var v=M(r);f=j(v,u),v.forEach(h),A=B(_),m=E(_,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0,style:!0}),p=B(_),Y(T.$$.fragment,_),this.h()},h(){c(e,"tabindex","0"),c(e,"poster",s[1]),e.loop=s[4],X(e.src,t=s[0])||c(e,"src",t),c(e,"preload","metadata"),c(e,"style",l=`aspect-ratio: ${s[2]} / ${s[3]}`),c(e,"class","svelte-a4gjoz"),s[8]===void 0&&et(()=>s[25].call(e)),c(r,"class","hidable svelte-a4gjoz"),F(r,"hide",s[10]),c(m,"type","range"),c(m,"min",0),c(m,"max",s[8]),c(m,"step",.0166666),c(m,"class","hidable svelte-a4gjoz"),c(m,"style",w=`background-image: linear-gradient(90deg, var(--accent) ${s[14]}%, var(--background-2) ${s[14]}%);}`),F(m,"hide",s[13])},m(_,v){I(_,e,v),s[22](e),I(_,i,v),I(_,r,v),D(r,f),I(_,A,v),I(_,m,v),fe(m,s[7]),I(_,p,v),x(T,_,v),b=!0,g||(d=[N(e,"play",s[23]),N(e,"pause",s[23]),N(e,"timeupdate",z),N(e,"durationchange",s[25]),N(e,"waiting",s[26]),N(e,"playing",s[27]),N(e,"pause",s[28]),N(e,"ended",s[29]),N(e,"click",s[20]),N(e,"dblclick",tt(st(s[17]))),N(m,"change",s[30]),N(m,"input",s[30])],g=!0)},p(_,v){(!b||v[0]&2)&&c(e,"poster",_[1]),(!b||v[0]&16)&&(e.loop=_[4]),(!b||v[0]&1&&!X(e.src,t=_[0]))&&c(e,"src",t),(!b||v[0]&12&&l!==(l=`aspect-ratio: ${_[2]} / ${_[3]}`))&&c(e,"style",l),v[0]&32768&&n!==(n=_[15])&&e[n?"pause":"play"](),!o&&v[0]&128&&!isNaN(_[7])&&(e.currentTime=_[7]),o=!1,(!b||v[0]&65536)&&u!==(u=Se(_[16])+"")&&U(f,u),(!b||v[0]&1024)&&F(r,"hide",_[10]),(!b||v[0]&256)&&c(m,"max",_[8]),(!b||v[0]&16384&&w!==(w=`background-image: linear-gradient(90deg, var(--accent) ${_[14]}%, var(--background-2) ${_[14]}%);}`))&&c(m,"style",w),v[0]&128&&fe(m,_[7]),(!b||v[0]&8192)&&F(m,"hide",_[13]);const q={};v[0]&32&&(q.playing=_[5]),v[0]&64&&(q.loading=_[6]),v[0]&8192&&(q.class=`center hidable ${_[13]?"hide":""}`),T.$set(q)},i(_){b||(P(T.$$.fragment,_),b=!0)},o(_){C(T.$$.fragment,_),b=!1},d(_){_&&(h(e),h(i),h(r),h(A),h(m),h(p)),s[22](null),$(T,_),g=!1,ce(d)}}}function Jt(s){let e,t,l,n,o,a=s[9]&&Ae(s);return{c(){e=S("div"),a&&a.c(),this.h()},l(i){e=E(i,"DIV",{class:!0,style:!0});var r=M(e);a&&a.l(r),r.forEach(h),this.h()},h(){c(e,"class",t="post-media player "+s[21].class+" svelte-a4gjoz"),oe(e,"aspect-ratio",s[2]+"/"+s[3])},m(i,r){I(i,e,r),a&&a.m(e,null),s[31](e),l=!0,n||(o=N(e,"keydown",s[18]),n=!0)},p(i,r){i[9]?a?(a.p(i,r),r[0]&512&&P(a,1)):(a=Ae(i),a.c(),P(a,1),a.m(e,null)):a&&(ae(),C(a,1,1,()=>{a=null}),re()),(!l||r[0]&2097152&&t!==(t="post-media player "+i[21].class+" svelte-a4gjoz"))&&c(e,"class",t),(!l||r[0]&12)&&oe(e,"aspect-ratio",i[2]+"/"+i[3])},i(i){l||(P(a),l=!0)},o(i){C(a),l=!1},d(i){i&&h(e),a&&a.d(),s[31](null),n=!1,o()}}}const Ie=5;function Xt(s,e,t){let l,n,o,a,{src:i}=e,{poster:r}=e,{width:u}=e,{height:f}=e,{loop:A}=e,m,w,p=!1,T=!1,b=0,g=0,d=!1,z=!1;const _=()=>{t(7,b=Math.max(0,b-Ie))},v=()=>{t(7,b=Math.min(g,b+Ie))},q=y=>{y.offsetX<y.target.clientWidth/2?_():v()},ze=y=>{Ce(y)||y.key==="k"?(y.preventDefault(),t(5,p=!p)):y.key==="ArrowLeft"||y.key==="j"?_():(y.key==="ArrowRight"||y.key==="l")&&v()},K=new IntersectionObserver(y=>{for(const Ze of y)Ze.isIntersecting?t(9,d=!0):w&&(t(5,p=!1),t(6,T=!1),w.addEventListener("error",()=>{t(9,d=!1)},{once:!0}),t(12,w.src="",w))},{rootMargin:"0px"}),Ge=()=>{t(5,p=!p),t(6,T=!0),t(10,z=p)},je=()=>{t(10,z=!z)};xe(()=>K==null?void 0:K.observe(m)),$e(()=>K==null?void 0:K.unobserve(m));function Ue(y){Z[y?"unshift":"push"](()=>{w=y,t(12,w)})}function Fe(){n=this.paused,t(15,n),t(5,p),t(9,d)}function Oe(){b=this.currentTime,t(7,b)}function Be(){g=this.duration,t(8,g)}const qe=()=>t(6,T=!0),Ke=()=>t(6,T=!1),He=()=>t(6,T=!1),We=()=>{A||(t(6,T=!1),t(5,p=!1))};function Je(){b=nt(this.value),t(7,b)}function Xe(y){Z[y?"unshift":"push"](()=>{m=y,t(11,m)})}return s.$$set=y=>{t(21,e=te(te({},e),se(y))),"src"in y&&t(0,i=y.src),"poster"in y&&t(1,r=y.poster),"width"in y&&t(2,u=y.width),"height"in y&&t(3,f=y.height),"loop"in y&&t(4,A=y.loop)},s.$$.update=()=>{s.$$.dirty[0]&384&&t(16,l=g-b),s.$$.dirty[0]&544&&t(5,p=d&&p),s.$$.dirty[0]&32&&t(15,n=!p),s.$$.dirty[0]&384&&t(14,o=b/g*98+1),s.$$.dirty[0]&1120&&t(13,a=p&&!T&&z)},e=se(e),[i,r,u,f,A,p,T,b,g,d,z,m,w,a,o,n,l,q,ze,Ge,je,e,Ue,Fe,Oe,Be,qe,Ke,He,We,Je,Xe]}class vs extends V{constructor(e){super(),R(this,e,Xt,Jt,L,{src:0,poster:1,width:2,height:3,loop:4},null,[-1,-1])}}function Zt(s){let e,t,l,n,o,a,i,r,u,f,A,m,w;function p(g){s[13](g)}function T(g){s[14](g)}let b={class:"center"};return s[2]!==void 0&&(b.playing=s[2]),s[3]!==void 0&&(b.loading=s[3]),i=new Re({props:b}),Z.push(()=>_e(i,"playing",p)),Z.push(()=>_e(i,"loading",T)),{c(){e=S("div"),t=S("img"),a=O(),Q(i.$$.fragment),this.h()},l(g){e=E(g,"DIV",{class:!0,style:!0});var d=M(e);t=E(d,"IMG",{class:!0,loading:!0,"data-src":!0,alt:!0,width:!0,height:!0,tabindex:!0}),a=B(d),Y(i.$$.fragment,d),d.forEach(h),this.h()},h(){c(t,"class","post-media media-img svelte-1cndgba"),c(t,"loading","lazy"),c(t,"data-src",s[4]),c(t,"alt",l=s[0].id.toString()),c(t,"width",n=s[0].width),c(t,"height",o=s[0].height),c(t,"tabindex","0"),c(e,"class","container svelte-1cndgba"),c(e,"style",f=`aspect-ratio: ${s[0].width} / ${s[0].height}`)},m(g,d){I(g,e,d),D(e,t),s[9](t),D(e,a),x(i,e,null),A=!0,m||(w=[N(t,"click",s[8]),N(t,"keydown",s[10]),N(t,"load",s[11]),N(t,"error",s[12],{once:!0}),Ne(Ve.call(null,t))],m=!0)},p(g,[d]){(!A||d&16)&&c(t,"data-src",g[4]),(!A||d&1&&l!==(l=g[0].id.toString()))&&c(t,"alt",l),(!A||d&1&&n!==(n=g[0].width))&&c(t,"width",n),(!A||d&1&&o!==(o=g[0].height))&&c(t,"height",o);const z={};!r&&d&4&&(r=!0,z.playing=g[2],he(()=>r=!1)),!u&&d&8&&(u=!0,z.loading=g[3],he(()=>u=!1)),i.$set(z),(!A||d&1&&f!==(f=`aspect-ratio: ${g[0].width} / ${g[0].height}`))&&c(e,"style",f)},i(g){A||(P(i.$$.fragment,g),A=!0)},o(g){C(i.$$.fragment,g),A=!1},d(g){g&&h(e),s[9](null),$(i),m=!1,ce(w)}}}function Qt(s,e,t){let l,n,o,a,{post:i}=e,r,u=!1,f=!1;function A(d){De.call(this,s,d)}function m(d){Z[d?"unshift":"push"](()=>{r=d,t(1,r),t(2,u),t(6,n),t(5,o),t(7,l),t(0,i)})}const w=d=>{Le(d),Ce(d)&&(d.preventDefault(),t(3,f=!0),t(2,u=!u))},p=()=>t(3,f=!1),T=d=>{t(3,f=!1),d.target.src=`${ee}/assets/failed-to-load.svg`};function b(d){u=d,t(2,u)}function g(d){f=d,t(3,f)}return s.$$set=d=>{"post"in d&&t(0,i=d.post)},s.$$.update=()=>{s.$$.dirty&1&&t(7,l=Mt(i.file_url,i.sample_url,i.preview_url)),s.$$.dirty&128&&t(6,n=l.animated),s.$$.dirty&128&&t(5,o=l.static),s.$$.dirty&100&&t(4,a=u?n:o),s.$$.dirty&102&&r&&t(1,r.src=u?n:o,r)},[i,r,u,f,a,o,n,l,A,m,w,p,T,b,g]}class ks extends V{constructor(e){super(),R(this,e,Qt,Zt,L,{post:0})}}export{gt as C,fs as E,ks as G,ys as I,hs as K,ds as P,os as R,us as S,vs as V,cs as a,_s as b,Mt as c,gs as d,Pt as e,ms as f,me as g,bs as h,ps as i};
